<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Capstone反汇编引擎数据类型及API分析及示例(四) | K's House</title><meta name="description" content="Capstone反汇编引擎数据类型及API分析及示例(四)"><meta name="keywords" content="反汇编"><meta name="author" content="kabeor"><meta name="copyright" content="kabeor"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Capstone反汇编引擎数据类型及API分析及示例(四)"><meta name="twitter:description" content="Capstone反汇编引擎数据类型及API分析及示例(四)"><meta name="twitter:image" content="https://i.loli.net/2018/07/16/5b4c6341c0e72.png"><meta property="og:type" content="article"><meta property="og:title" content="Capstone反汇编引擎数据类型及API分析及示例(四)"><meta property="og:url" content="https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E5%9B%9B)/"><meta property="og:site_name" content="K's House"><meta property="og:description" content="Capstone反汇编引擎数据类型及API分析及示例(四)"><meta property="og:image" content="https://i.loli.net/2018/07/16/5b4c6341c0e72.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E5%9B%9B)/"><link rel="prev" title="2019湖湘杯线上 RE WriteUp" href="https://kabeor.github.io/2019%E6%B9%96%E6%B9%98%E6%9D%AF%E7%BA%BF%E4%B8%8ARE%20WriteUp/"><link rel="next" title="2018护网杯线上 APM233" href="https://kabeor.github.io/2018%E6%8A%A4%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8A%20APM233/"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-113413523-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">K's House</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://kabeor.cn/img/avatarme.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">125</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">67</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">30</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Capstone反汇编引擎数据类型及API分析及示例-四"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Capstone反汇编引擎数据类型及API分析及示例(四)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#API分析"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">API分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-free"><span class="toc_mobile_items-number">1.1.1.</span> <span class="toc_mobile_items-text">cs_free</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-malloc"><span class="toc_mobile_items-number">1.1.2.</span> <span class="toc_mobile_items-text">cs_malloc</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-disasm-iter"><span class="toc_mobile_items-number">1.1.3.</span> <span class="toc_mobile_items-text">cs_disasm_iter</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-reg-name"><span class="toc_mobile_items-number">1.1.4.</span> <span class="toc_mobile_items-text">cs_reg_name</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-insn-name"><span class="toc_mobile_items-number">1.1.5.</span> <span class="toc_mobile_items-text">cs_insn_name</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-group-name"><span class="toc_mobile_items-number">1.1.6.</span> <span class="toc_mobile_items-text">cs_group_name</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-insn-group"><span class="toc_mobile_items-number">1.1.7.</span> <span class="toc_mobile_items-text">cs_insn_group</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-reg-read"><span class="toc_mobile_items-number">1.1.8.</span> <span class="toc_mobile_items-text">cs_reg_read</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-reg-write"><span class="toc_mobile_items-number">1.1.9.</span> <span class="toc_mobile_items-text">cs_reg_write</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-op-count"><span class="toc_mobile_items-number">1.1.10.</span> <span class="toc_mobile_items-text">cs_op_count</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-op-index"><span class="toc_mobile_items-number">1.1.11.</span> <span class="toc_mobile_items-text">cs_op_index</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-regs-access"><span class="toc_mobile_items-number">1.1.12.</span> <span class="toc_mobile_items-text">cs_regs_access</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Capstone反汇编引擎数据类型及API分析及示例-四"><span class="toc-number">1.</span> <span class="toc-text">Capstone反汇编引擎数据类型及API分析及示例(四)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#API分析"><span class="toc-number">1.1.</span> <span class="toc-text">API分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-free"><span class="toc-number">1.1.1.</span> <span class="toc-text">cs_free</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-malloc"><span class="toc-number">1.1.2.</span> <span class="toc-text">cs_malloc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-disasm-iter"><span class="toc-number">1.1.3.</span> <span class="toc-text">cs_disasm_iter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-reg-name"><span class="toc-number">1.1.4.</span> <span class="toc-text">cs_reg_name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-insn-name"><span class="toc-number">1.1.5.</span> <span class="toc-text">cs_insn_name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-group-name"><span class="toc-number">1.1.6.</span> <span class="toc-text">cs_group_name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-insn-group"><span class="toc-number">1.1.7.</span> <span class="toc-text">cs_insn_group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-reg-read"><span class="toc-number">1.1.8.</span> <span class="toc-text">cs_reg_read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-reg-write"><span class="toc-number">1.1.9.</span> <span class="toc-text">cs_reg_write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-op-count"><span class="toc-number">1.1.10.</span> <span class="toc-text">cs_op_count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-op-index"><span class="toc-number">1.1.11.</span> <span class="toc-text">cs_op_index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-regs-access"><span class="toc-number">1.1.12.</span> <span class="toc-text">cs_regs_access</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2018/07/16/5b4c6341c0e72.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Capstone反汇编引擎数据类型及API分析及示例(四)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-08-14<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-03-16</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%80%86%E5%90%91/">逆向</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">5.4k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 28 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E5%9B%9B)/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E5%9B%9B)/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Capstone反汇编引擎数据类型及API分析及示例-四"><a href="#Capstone反汇编引擎数据类型及API分析及示例-四" class="headerlink" title="Capstone反汇编引擎数据类型及API分析及示例(四)"></a>Capstone反汇编引擎数据类型及API分析及示例(四)</h1><h2 id="API分析"><a href="#API分析" class="headerlink" title="API分析"></a>API分析</h2><h3 id="cs-free"><a href="#cs-free" class="headerlink" title="cs_free"></a>cs_free</h3><p><code>void CAPSTONE_API cs_free(cs_insn *insn, size_t count);</code></p>
<p>释放被cs_malloc() 或 cs_disasm()分配的内存(insn参数)<br>参数<br>insn: 由cs_disasm()或cs_malloc()中的@insn参数返回的指针<br>count: 赋值由cs_disasm()返回的cs_insn结构的数量，或赋值为1表示由cs_malloc()分配给空闲内存的数量</p>
<p>代码实现<br><a href="https://i.loli.net/2019/07/27/5d3bf583b748d86745.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3bf583b748d86745.jpg" class="lazyload" title></a><br>直接调用cs_mem_free,也就是默认的free</p>
<p>示例(释放cs_disasm申请的内存)，代码片段：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">count = cs_disasm(handle, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)CODE, <span class="keyword">sizeof</span>(CODE) - <span class="number">1</span>, <span class="number">0x1000</span>, <span class="number">0</span>, &amp;insn);           <span class="comment">//计数由cs_disasm申请的内存</span></span><br><span class="line"><span class="keyword">if</span> (count) &#123;</span><br><span class="line">	<span class="keyword">size_t</span> j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; count; j++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"0x%"</span><span class="string">"Ix"</span><span class="string">":\t%s\t\t%s\n"</span>, insn[j].address, insn[j].mnemonic, insn[j].op_str);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cs_free(insn, count);   <span class="comment">//循环依次释放每条insn的内存</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="cs-malloc"><a href="#cs-malloc" class="headerlink" title="cs_malloc"></a>cs_malloc</h3><p><code>cs_insn * CAPSTONE_API cs_malloc(csh handle);</code></p>
<p>被用于在API cs_disasm_iter()中为一条指令分配内存</p>
<p>参数<br>handle: cs_open()返回的句柄</p>
<p>代码实现<br><a href="https://i.loli.net/2019/07/27/5d3bf97c0299d21615.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3bf97c0299d21615.jpg" class="lazyload" title></a></p>
<p>当这条指令所占的内存不再使用时，使用cs_free(insn, 1)释放，示例在下面cs_disasm_iter处</p>
<h3 id="cs-disasm-iter"><a href="#cs-disasm-iter" class="headerlink" title="cs_disasm_iter"></a>cs_disasm_iter</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> CAPSTONE_API <span class="title">cs_disasm_iter</span><span class="params">(csh handle,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">const</span> <span class="keyword">uint8_t</span> **code, <span class="keyword">size_t</span> *size,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">uint64_t</span> *address, cs_insn *insn)</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>给定buff、大小、地址和要解码的指令数，更快速的反汇编机器码，<br>这个API将生成的指令放入insn中的给定的缓存中。</p>
<p>注意1: 此API将更新code、size和address以指向输入缓冲区中的下一条指令。所以，虽然每次反汇编一条指令可以使用cs_disasm(count=1)来实现，但一些基准测试显示，在循环中使用cs_disasm_iter()可以方便地快速迭代所有指令，在随机输入时可以快30%。</p>
<p>注意2:可以使用cs_malloc()创建insn中的缓存。</p>
<p>注意3:对于动态分配内存可能产生内存不足的系统(比如OS内核或固件)，建议使用cs_disasm()这个API, 因为cs_disasm()是根据要分解的指令的数量来分配内存。</p>
<p>参数<br>handle: cs_open()返回的句柄<br>code: 要反汇编的机器码所在的缓冲区<br>size: 机器码缓冲区的大小<br>address: 所给机器码缓冲区中第一个insn的地址<br>insn: 指向这个API要填充的指令的指针。<br>return:如果这个API成功反汇编了一条指令返回true，否则将返回false。</p>
<p>失败时，调用cs_errno()获取错误代码。</p>
<p>代码实现，在cs_disasm基础上使用动态内存分配</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> CAPSTONE_API <span class="title">cs_disasm_iter</span><span class="params">(csh ud, <span class="keyword">const</span> <span class="keyword">uint8_t</span> **code, <span class="keyword">size_t</span> *size,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">uint64_t</span> *address, cs_insn *insn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">handle</span>;</span></span><br><span class="line">	<span class="keyword">uint16_t</span> insn_size;</span><br><span class="line">	MCInst mci;</span><br><span class="line">	<span class="keyword">bool</span> r;</span><br><span class="line"></span><br><span class="line">	handle = (struct cs_struct *)(<span class="keyword">uintptr_t</span>)ud;</span><br><span class="line">	<span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	handle-&gt;errnum = CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">	MCInst_Init(&amp;mci);</span><br><span class="line">	mci.csh = handle;</span><br><span class="line"></span><br><span class="line">	mci.address = *address;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 为无detail模式保存相关信息</span></span><br><span class="line">	mci.flat_insn = insn;</span><br><span class="line">	mci.flat_insn-&gt;address = *address;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CAPSTONE_DIET</span></span><br><span class="line">	mci.flat_insn-&gt;mnemonic[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line">	mci.flat_insn-&gt;op_str[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	r = handle-&gt;disasm(ud, *code, *size, &amp;mci, &amp;insn_size, *address, handle-&gt;getinsn_info);</span><br><span class="line">	<span class="keyword">if</span> (r) &#123;</span><br><span class="line">		SStream ss;</span><br><span class="line">		SStream_Init(&amp;ss);</span><br><span class="line"></span><br><span class="line">		mci.flat_insn-&gt;size = insn_size;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 将内部指令操作码映射到公共insn ID</span></span><br><span class="line">		handle-&gt;insn_id(handle, insn, mci.Opcode);</span><br><span class="line"></span><br><span class="line">		handle-&gt;printer(&amp;mci, &amp;ss, handle-&gt;printer_info);</span><br><span class="line"></span><br><span class="line">		fill_insn(handle, insn, ss.buffer, &amp;mci, handle-&gt;post_printer, *code);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 调整伪操作码(X86)</span></span><br><span class="line">		<span class="keyword">if</span> (handle-&gt;arch == CS_ARCH_X86)</span><br><span class="line">			insn-&gt;id += mci.popcode_adjust;</span><br><span class="line"></span><br><span class="line">		*code += insn_size;</span><br><span class="line">		*size -= insn_size;</span><br><span class="line">		*address += insn_size;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123; 	<span class="comment">// 遇到中断指令</span></span><br><span class="line">		<span class="keyword">size_t</span> skipdata_bytes;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果没有跳过数据的请求，或者剩余数据太小，则退出</span></span><br><span class="line">		<span class="keyword">if</span> (!handle-&gt;skipdata || handle-&gt;skipdata_size &gt; *size)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (handle-&gt;skipdata_setup.callback) &#123;</span><br><span class="line">			skipdata_bytes = handle-&gt;skipdata_setup.callback(*code, *size,</span><br><span class="line">					<span class="number">0</span>, handle-&gt;skipdata_setup.user_data);</span><br><span class="line">			<span class="keyword">if</span> (skipdata_bytes &gt; *size)</span><br><span class="line">				<span class="comment">// 剩余数据太小</span></span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (!skipdata_bytes)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span></span><br><span class="line">			skipdata_bytes = handle-&gt;skipdata_size;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 基于架构和模式跳过一些数据</span></span><br><span class="line">		insn-&gt;id = <span class="number">0</span>;	<span class="comment">// 此“数据”指令的ID无效</span></span><br><span class="line">		insn-&gt;address = *address;</span><br><span class="line">		insn-&gt;size = (<span class="keyword">uint16_t</span>)skipdata_bytes;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CAPSTONE_DIET</span></span><br><span class="line">		insn-&gt;mnemonic[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line">		insn-&gt;op_str[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">		<span class="built_in">memcpy</span>(insn-&gt;bytes, *code, skipdata_bytes);</span><br><span class="line">		<span class="built_in">strncpy</span>(insn-&gt;mnemonic, handle-&gt;skipdata_setup.mnemonic,</span><br><span class="line">				<span class="keyword">sizeof</span>(insn-&gt;mnemonic) - <span class="number">1</span>);</span><br><span class="line">		skipdata_opstr(insn-&gt;op_str, *code, skipdata_bytes);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">		*code += skipdata_bytes;</span><br><span class="line">		*size -= skipdata_bytes;</span><br><span class="line">		*address += skipdata_bytes;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform</span> &#123;</span></span><br><span class="line">	cs_arch arch;</span><br><span class="line">	cs_mode mode;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span>* comment;</span><br><span class="line">	cs_opt_type opt_type;</span><br><span class="line">	cs_opt_value opt_value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_string_hex</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* str, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* c;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Code: "</span>);</span><br><span class="line">	<span class="keyword">for</span> (c = str; c &lt; str + len; c++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, *c &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE16 <span class="meta-string">"\x8d\x4c\x32\x08\x01\xd8\x81\xc6\x34\x12\x00\x00"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE32 <span class="meta-string">"\x8d\x4c\x32\x08\x01\xd8\x81\xc6\x34\x12\x00\x00"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE64 <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00"</span></span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform</span> <span class="title">platforms</span>[4] = &#123;</span>     <span class="comment">//架构及模式</span></span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_16,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE16,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE32) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 16bit (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_32,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE32,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE32) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 32bit (ATT syntax)"</span>,</span><br><span class="line">			CS_OPT_SYNTAX,</span><br><span class="line">			CS_OPT_SYNTAX_ATT,</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_32,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE32,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE32) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 32 (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_64,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE64,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE64) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 64 (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">	csh handle;</span><br><span class="line">	<span class="keyword">uint64_t</span> address;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	cs_detail* detail;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	cs_err err;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(platforms) / <span class="keyword">sizeof</span>(platforms[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"****************\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Platform: %s\n"</span>, platforms[i].comment);</span><br><span class="line">		err = cs_open(platforms[i].arch, platforms[i].mode, &amp;handle);</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Failed on cs_open() with error returned: %u\n"</span>, err);</span><br><span class="line">			<span class="built_in">abort</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (platforms[i].opt_type)</span><br><span class="line">			cs_option(handle, platforms[i].opt_type, platforms[i].opt_value);</span><br><span class="line"></span><br><span class="line">		cs_option(handle, CS_OPT_DETAIL, CS_OPT_ON);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 为cs_disasm_iter()分配内存</span></span><br><span class="line">		insn = cs_malloc(handle);</span><br><span class="line"></span><br><span class="line">		print_string_hex(platforms[i].code, platforms[i].size);   <span class="comment">//原机器码</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Disasm:\n"</span>);</span><br><span class="line"></span><br><span class="line">		address = <span class="number">0x1000</span>;</span><br><span class="line">		code = platforms[i].code;</span><br><span class="line">		size = platforms[i].size;</span><br><span class="line">		<span class="keyword">while</span> (cs_disasm_iter(handle, &amp;code, &amp;size, &amp;address, insn)) &#123;   <span class="comment">//cs_disasm_iter反汇编</span></span><br><span class="line">			<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span> PRIx64 <span class="string">":\t%s\t\t%s // insn-ID: %u, insn-mnem: %s\n"</span>,</span><br><span class="line">				insn-&gt;address, insn-&gt;mnemonic, insn-&gt;op_str,</span><br><span class="line">				insn-&gt;id, cs_insn_name(handle, insn-&gt;id));</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 打印此指令使用的隐式寄存器</span></span><br><span class="line">			detail = insn-&gt;detail;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (detail-&gt;regs_read_count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"\tImplicit registers read: "</span>);</span><br><span class="line">				<span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; detail-&gt;regs_read_count; n++) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"%s "</span>, cs_reg_name(handle, detail-&gt;regs_read[n]));</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 打印此指令修改的隐式寄存器</span></span><br><span class="line">			<span class="keyword">if</span> (detail-&gt;regs_write_count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"\tImplicit registers modified: "</span>);</span><br><span class="line">				<span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; detail-&gt;regs_write_count; n++) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"%s "</span>, cs_reg_name(handle, detail-&gt;regs_write[n]));</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 打印此指令所属指令集</span></span><br><span class="line">			<span class="keyword">if</span> (detail-&gt;groups_count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"\tThis instruction belongs to groups: "</span>);</span><br><span class="line">				<span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; detail-&gt;groups_count; n++) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"%s "</span>, cs_group_name(handle, detail-&gt;groups[n]));</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 释放cs_malloc()分配的内存</span></span><br><span class="line">		cs_free(insn, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">		cs_close(&amp;handle);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	test();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>输出<br><a href="https://i.loli.net/2019/07/27/5d3c063cd33b421225.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c063cd33b421225.jpg" class="lazyload" title></a></p>
<h3 id="cs-reg-name"><a href="#cs-reg-name" class="headerlink" title="cs_reg_name"></a>cs_reg_name</h3><p><code>const char * CAPSTONE_API cs_reg_name(csh handle, unsigned int reg_id);</code></p>
<p>获取寄存器的名字(string类型)<br>寄存器id可在相关架构的头文件(建立项目时复制到项目文件夹的那些头文件)内找到</p>
<p>注意： 当处于diet模式时此API不可用，因为引擎不会存储寄存器名</p>
<p>参数<br>handle: cs_open()返回的句柄<br>reg_id: 寄存器id<br>return: 寄存器的字符名, 如果reg_id不可用返回NULL</p>
<p>代码实现<br><a href="https://i.loli.net/2019/07/27/5d3c0dcfa15c265034.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c0dcfa15c265034.jpg" class="lazyload" title></a></p>
<p>示例(打印RAX)：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	csh handle = <span class="number">0</span>;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	<span class="keyword">size_t</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cs_open(CS_ARCH_X86, CS_MODE_64, &amp;handle)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"ERROR: Failed to initialize engine!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>, cs_reg_name(handle, X86_REG_RAX));</span><br><span class="line">	cs_close(&amp;handle);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出<br><a href="https://i.loli.net/2019/07/27/5d3c100276bac46235.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c100276bac46235.jpg" class="lazyload" title></a></p>
<h3 id="cs-insn-name"><a href="#cs-insn-name" class="headerlink" title="cs_insn_name"></a>cs_insn_name</h3><p><code>const char * CAPSTONE_API cs_insn_name(csh handle, unsigned int insn_id);</code></p>
<p>获取指令的名字(string类型)<br>指令id可在相关架构的头文件(建立项目时复制到项目文件夹的那些头文件)内找到</p>
<p>注意： 当处于diet模式时此API不可用，因为引擎不会存储寄存器名</p>
<p>参数<br>handle: cs_open()返回的句柄<br>insn_id: 指令id<br>return: 指令的字符名, 如果insn_id不可用返回NULL</p>
<p>代码实现<br><a href="https://i.loli.net/2019/07/27/5d3c18c11f4cc51220.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c18c11f4cc51220.jpg" class="lazyload" title></a></p>
<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform</span> &#123;</span></span><br><span class="line">	cs_arch arch;</span><br><span class="line">	cs_mode mode;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span>* comment;</span><br><span class="line">	cs_opt_type opt_type;</span><br><span class="line">	cs_opt_value opt_value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_string_hex</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* str, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* c;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Code: "</span>);</span><br><span class="line">	<span class="keyword">for</span> (c = str; c &lt; str + len; c++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, *c &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE64 <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00\xe9\xea\xbe\xad\xde\xff\x25\x23\x01\x00\x00\xe8\xdf\xbe\xad\xde\x74\xff"</span></span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform</span> <span class="title">platforms</span>[] = &#123;</span></span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_64,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE64,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE64) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 64 (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	csh handle;</span><br><span class="line">	<span class="keyword">uint64_t</span> address;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	cs_detail* detail;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	cs_err err;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(platforms) / <span class="keyword">sizeof</span>(platforms[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"****************\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Platform: %s\n"</span>, platforms[i].comment);</span><br><span class="line">		err = cs_open(platforms[i].arch, platforms[i].mode, &amp;handle);</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Failed on cs_open() with error returned: %u\n"</span>, err);</span><br><span class="line">			<span class="built_in">abort</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (platforms[i].opt_type)</span><br><span class="line">			cs_option(handle, platforms[i].opt_type, platforms[i].opt_value);</span><br><span class="line"></span><br><span class="line">		cs_option(handle, CS_OPT_DETAIL, CS_OPT_ON);</span><br><span class="line"></span><br><span class="line">		insn = cs_malloc(handle);</span><br><span class="line"></span><br><span class="line">		print_string_hex(platforms[i].code, platforms[i].size);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Disasm:\n"</span>);</span><br><span class="line"></span><br><span class="line">		address = <span class="number">0x1000</span>;</span><br><span class="line">		code = platforms[i].code;</span><br><span class="line">		size = platforms[i].size;</span><br><span class="line">		<span class="keyword">while</span> (cs_disasm_iter(handle, &amp;code, &amp;size, &amp;address, insn)) &#123;</span><br><span class="line">			<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span> PRIx64 <span class="string">":\t%s\t\t%s"</span>,</span><br><span class="line">				insn-&gt;address, insn-&gt;mnemonic, insn-&gt;op_str);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"            instruction:  %s"</span>, cs_insn_name(handle, insn-&gt;id));   <span class="comment">//输出该行的操作指令</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">		cs_free(insn, <span class="number">1</span>);</span><br><span class="line">		cs_close(&amp;handle);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	test();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出<br><a href="https://i.loli.net/2019/07/27/5d3c250a6507076991.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c250a6507076991.jpg" class="lazyload" title></a></p>
<h3 id="cs-group-name"><a href="#cs-group-name" class="headerlink" title="cs_group_name"></a>cs_group_name</h3><p><code>const char * CAPSTONE_API cs_group_name(csh handle, unsigned int group_id);</code></p>
<p>输出指令类型名字<br>指令id可在相关架构的头文件(建立项目时复制到项目文件夹的那些头文件)内找到</p>
<p>注意： 当处于diet模式时此API不可用，因为引擎不会存储寄存器名</p>
<p>参数<br>handle: cs_open()返回的句柄<br>insn_id: 指令类型id<br>return: 指令类型的字符名, 如果insn_id不可用返回NULL</p>
<p>实现代码及示例都与上面类似，略。。</p>
<h3 id="cs-insn-group"><a href="#cs-insn-group" class="headerlink" title="cs_insn_group"></a>cs_insn_group</h3><p><code>bool CAPSTONE_API cs_insn_group(csh handle, const cs_insn *insn, unsigned int group_id);</code></p>
<p>检查反汇编后的指令是否属于某个特定指令类型。</p>
<p>注意：只有当detail选项为ON时这个API可用 (默认OFF).<br>在“diet”模式下，此API没有用，因为引擎不更新insn-&gt;groups数组。</p>
<p>handle: cs_open()返回的句柄<br>insn: 从cs_disasm()或cs_disasm_iter()接收的反汇编指令结构<br>group_id: 要检查此指令是否属于的指令类型。<br>return: 如果该指令确实属于给定的指令类型，则为true，否则为false。</p>
<p>代码实现<br><a href="https://i.loli.net/2019/07/27/5d3c28779993339180.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c28779993339180.png" class="lazyload" title></a></p>
<p>示例(判断是否属于跳转指令)：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform</span> &#123;</span></span><br><span class="line">	cs_arch arch;</span><br><span class="line">	cs_mode mode;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span>* comment;</span><br><span class="line">	cs_opt_type opt_type;</span><br><span class="line">	cs_opt_value opt_value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_string_hex</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* str, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* c;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Code: "</span>);</span><br><span class="line">	<span class="keyword">for</span> (c = str; c &lt; str + len; c++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, *c &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE64 <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00\xe9\xea\xbe\xad\xde\xff\x25\x23\x01\x00\x00\xe8\xdf\xbe\xad\xde\x74\xff"</span></span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform</span> <span class="title">platforms</span>[] = &#123;</span></span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_64,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE64,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE64) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 64 (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	csh handle;</span><br><span class="line">	<span class="keyword">uint64_t</span> address;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	cs_detail* detail;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	cs_err err;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(platforms) / <span class="keyword">sizeof</span>(platforms[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"****************\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Platform: %s\n"</span>, platforms[i].comment);</span><br><span class="line">		err = cs_open(platforms[i].arch, platforms[i].mode, &amp;handle);</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Failed on cs_open() with error returned: %u\n"</span>, err);</span><br><span class="line">			<span class="built_in">abort</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (platforms[i].opt_type)</span><br><span class="line">			cs_option(handle, platforms[i].opt_type, platforms[i].opt_value);</span><br><span class="line"></span><br><span class="line">		cs_option(handle, CS_OPT_DETAIL, CS_OPT_ON);</span><br><span class="line"></span><br><span class="line">		insn = cs_malloc(handle);</span><br><span class="line"></span><br><span class="line">		print_string_hex(platforms[i].code, platforms[i].size);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Disasm:\n"</span>);</span><br><span class="line"></span><br><span class="line">		address = <span class="number">0x1000</span>;</span><br><span class="line">		code = platforms[i].code;</span><br><span class="line">		size = platforms[i].size;</span><br><span class="line">		<span class="keyword">while</span> (cs_disasm_iter(handle, &amp;code, &amp;size, &amp;address, insn)) &#123;</span><br><span class="line">			<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span> PRIx64 <span class="string">":\t%s\t\t%s          "</span>,</span><br><span class="line">				insn-&gt;address, insn-&gt;mnemonic, insn-&gt;op_str);</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"is JUMP:   "</span> &lt;&lt;cs_insn_group(handle, insn, CS_GRP_JUMP) &lt;&lt; <span class="built_in">endl</span>;   <span class="comment">//判断是否为跳转指令</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">		cs_free(insn, <span class="number">1</span>);</span><br><span class="line">		cs_close(&amp;handle);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	test();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出<br><a href="https://i.loli.net/2019/07/27/5d3c2cad6a6ee36943.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c2cad6a6ee36943.jpg" class="lazyload" title></a></p>
<h3 id="cs-reg-read"><a href="#cs-reg-read" class="headerlink" title="cs_reg_read"></a>cs_reg_read</h3><p><code>bool CAPSTONE_API cs_reg_read(csh handle, const cs_insn *insn, unsigned int reg_id);</code></p>
<p>检查反汇编指令是否隐式使用特定寄存器。</p>
<p>注意:此API仅在启用detail选项时有效(默认为关闭)<br>在“diet”模式下，此API没有用，因为引擎不更新insn-&gt;regs_read数组。</p>
<p>insn: 从cs_disasm()或cs_disasm_iter()接收的反汇编指令结构<br>reg_id: 标注想要检查的这个指令是否使用了它。<br>return: 如果该指令确实隐式使用了给定寄存器，则为true，否则为false。</p>
<p>代码实现<br><a href="https://i.loli.net/2019/07/27/5d3c2ec62282774188.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c2ec62282774188.jpg" class="lazyload" title></a></p>
<p>示例同API cs_disasm_iter</p>
<h3 id="cs-reg-write"><a href="#cs-reg-write" class="headerlink" title="cs_reg_write"></a>cs_reg_write</h3><p><code>bool CAPSTONE_API cs_reg_write(csh handle, const cs_insn *insn, unsigned int reg_id);</code></p>
<p>检查反汇编指令是否隐式修改了特定寄存器。</p>
<p>注意:此API仅在启用detail选项时有效(默认为关闭)<br>在“diet”模式下，此API没有用，因为引擎不更新insn-&gt;regs_read数组。</p>
<p>insn: 从cs_disasm()或cs_disasm_iter()接收的反汇编指令结构<br>reg_id: 标注想要检查的这个指令是否修改了它。<br>return: 如果该指令确实隐式修改了给定寄存器，则为true，否则为false。</p>
<p>代码实现<br><a href="https://i.loli.net/2019/07/27/5d3c2f67ee69f50813.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c2f67ee69f50813.jpg" class="lazyload" title></a></p>
<p>示例同API cs_disasm_iter</p>
<h3 id="cs-op-count"><a href="#cs-op-count" class="headerlink" title="cs_op_count"></a>cs_op_count</h3><p><code>int CAPSTONE_API cs_op_count(csh handle, const cs_insn *insn, unsigned int op_type);</code></p>
<p>计算给定类型的操作数的数量。<br>注意：只有当detail选项为ON时这个API可用 (默认OFF).</p>
<p>handle: cs_open()返回的句柄<br>insn: 从cs_disasm()或cs_disasm_iter()接收的反汇编指令结构<br>op_type: 要找到的操作数类型。<br>return: 指令insn中给定类型op_type的操作数的数量，返回-1表示查找失败。</p>
<p>代码实现</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> CAPSTONE_API <span class="title">cs_op_count</span><span class="params">(csh ud, <span class="keyword">const</span> cs_insn *insn, <span class="keyword">unsigned</span> <span class="keyword">int</span> op_type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">handle</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>, i;</span><br><span class="line">	<span class="keyword">if</span> (!ud)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	handle = (struct cs_struct *)(<span class="keyword">uintptr_t</span>)ud;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!handle-&gt;detail) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_DETAIL;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!insn-&gt;id) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_SKIPDATA;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!insn-&gt;detail) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_DETAIL;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	handle-&gt;errnum = CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (handle-&gt;arch) &#123;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			handle-&gt;errnum = CS_ERR_HANDLE;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_ARM:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;arm.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;arm.operands[i].type == (arm_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_ARM64:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;arm64.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;arm64.operands[i].type == (arm64_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_X86:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;x86.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;x86.operands[i].type == (x86_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_MIPS:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;mips.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;mips.operands[i].type == (mips_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_PPC:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;ppc.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;ppc.operands[i].type == (ppc_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_SPARC:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;sparc.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;sparc.operands[i].type == (sparc_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_SYSZ:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;sysz.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;sysz.operands[i].type == (sysz_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_XCORE:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;xcore.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;xcore.operands[i].type == (xcore_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_M68K:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;m68k.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;m68k.operands[i].type == (m68k_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_TMS320C64X:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;tms320c64x.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;tms320c64x.operands[i].type == (tms320c64x_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_M680X:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;m680x.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;m680x.operands[i].type == (m680x_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_EVM:</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 0</span></span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;evm.op_count; i++)</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;evm.operands[i].type == (evm_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>拿x86指令操作码类型举例</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> x86_op_type &#123;</span><br><span class="line">	X86_OP_INVALID = <span class="number">0</span>, <span class="comment">///&lt; = CS_OP_INVALID (未初始化).</span></span><br><span class="line">	X86_OP_REG, <span class="comment">///&lt; = CS_OP_REG (寄存操作码).</span></span><br><span class="line">	X86_OP_IMM, <span class="comment">///&lt; = CS_OP_IMM (立即操作码).</span></span><br><span class="line">	X86_OP_MEM, <span class="comment">///&lt; = CS_OP_MEM (内存操作码).</span></span><br><span class="line">&#125; x86_op_type;</span><br></pre></td></tr></table></figure></div>

<p>示例(判断寄存操作码)：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform</span> &#123;</span></span><br><span class="line">	cs_arch arch;</span><br><span class="line">	cs_mode mode;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span>* comment;</span><br><span class="line">	cs_opt_type opt_type;</span><br><span class="line">	cs_opt_value opt_value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_string_hex</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* str, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* c;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Code: "</span>);</span><br><span class="line">	<span class="keyword">for</span> (c = str; c &lt; str + len; c++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, *c &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE64 <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00\xe9\xea\xbe\xad\xde\xff\x25\x23\x01\x00\x00\xe8\xdf\xbe\xad\xde\x74\xff"</span></span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform</span> <span class="title">platforms</span>[] = &#123;</span></span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_64,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE64,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE64) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 64 (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	csh handle;</span><br><span class="line">	<span class="keyword">uint64_t</span> address;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	cs_detail* detail;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	cs_err err;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(platforms) / <span class="keyword">sizeof</span>(platforms[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"****************\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Platform: %s\n"</span>, platforms[i].comment);</span><br><span class="line">		err = cs_open(platforms[i].arch, platforms[i].mode, &amp;handle);</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Failed on cs_open() with error returned: %u\n"</span>, err);</span><br><span class="line">			<span class="built_in">abort</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (platforms[i].opt_type)</span><br><span class="line">			cs_option(handle, platforms[i].opt_type, platforms[i].opt_value);</span><br><span class="line"></span><br><span class="line">		cs_option(handle, CS_OPT_DETAIL, CS_OPT_ON);</span><br><span class="line"></span><br><span class="line">		insn = cs_malloc(handle);</span><br><span class="line"></span><br><span class="line">		print_string_hex(platforms[i].code, platforms[i].size);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Disasm:\n"</span>);</span><br><span class="line"></span><br><span class="line">		address = <span class="number">0x1000</span>;</span><br><span class="line">		code = platforms[i].code;</span><br><span class="line">		size = platforms[i].size;</span><br><span class="line">		<span class="keyword">while</span> (cs_disasm_iter(handle, &amp;code, &amp;size, &amp;address, insn)) &#123;</span><br><span class="line">			<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span> PRIx64 <span class="string">":\t%s\t\t%s          "</span>,</span><br><span class="line">				insn-&gt;address, insn-&gt;mnemonic, insn-&gt;op_str);</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"is REG:   "</span> &lt;&lt; cs_op_count(handle, insn, X86_OP_REG) &lt;&lt; <span class="built_in">endl</span>;   <span class="comment">//判断是否为寄存操作码</span></span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">		cs_free(insn, <span class="number">1</span>);</span><br><span class="line">		cs_close(&amp;handle);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	test();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>输出<br><a href="https://i.loli.net/2019/07/27/5d3c32814f9e736661.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c32814f9e736661.jpg" class="lazyload" title></a></p>
<h3 id="cs-op-index"><a href="#cs-op-index" class="headerlink" title="cs_op_index"></a>cs_op_index</h3><p><code>int CAPSTONE_API cs_op_index(csh handle, const cs_insn *insn, unsigned int op_type, unsigned int position);</code></p>
<p>检索给定类型的操作数在<code>&lt;arch&gt;.operands[]</code>数组中的位置, 使用返回的位置访问操作数。<br>注意：只有当detail选项为ON时这个API可用 (默认OFF).</p>
<p>handle: cs_open()返回的句柄<br>insn: 从cs_disasm()或cs_disasm_iter()接收的反汇编指令结构<br>op_type: 要找到的操作数类型。<br>position: 要查找的操作数的位置。范围一定在<code>[1, cs_op_count(handle, insn, op_type)]</code>内<br>return: 指令insn的<code>&lt;arch&gt;.operands[]</code>数组中给定类型op_type的操作数的索引，失败时返回-1。</p>
<p>代码实现</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> CAPSTONE_API <span class="title">cs_op_index</span><span class="params">(csh ud, <span class="keyword">const</span> cs_insn *insn, <span class="keyword">unsigned</span> <span class="keyword">int</span> op_type,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">unsigned</span> <span class="keyword">int</span> post)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">handle</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>, i;</span><br><span class="line">	<span class="keyword">if</span> (!ud)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	handle = (struct cs_struct *)(<span class="keyword">uintptr_t</span>)ud;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!handle-&gt;detail) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_DETAIL;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!insn-&gt;id) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_SKIPDATA;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!insn-&gt;detail) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_DETAIL;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	handle-&gt;errnum = CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (handle-&gt;arch) &#123;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			handle-&gt;errnum = CS_ERR_HANDLE;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_ARM:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;arm.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;arm.operands[i].type == (arm_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_ARM64:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;arm64.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;arm64.operands[i].type == (arm64_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_X86:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;x86.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;x86.operands[i].type == (x86_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_MIPS:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;mips.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;mips.operands[i].type == (mips_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_PPC:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;ppc.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;ppc.operands[i].type == (ppc_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_SPARC:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;sparc.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;sparc.operands[i].type == (sparc_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_SYSZ:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;sysz.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;sysz.operands[i].type == (sysz_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_XCORE:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;xcore.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;xcore.operands[i].type == (xcore_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_M68K:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;m68k.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;m68k.operands[i].type == (m68k_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_TMS320C64X:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;tms320c64x.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;tms320c64x.operands[i].type == (tms320c64x_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ARCH_M680X:</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; insn-&gt;detail-&gt;m680x.op_count; i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (insn-&gt;detail-&gt;m680x.operands[i].type == (m680x_op_type)op_type)</span><br><span class="line">					count++;</span><br><span class="line">				<span class="keyword">if</span> (count == post)</span><br><span class="line">					<span class="keyword">return</span> i;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>示例</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform</span> &#123;</span></span><br><span class="line">	cs_arch arch;</span><br><span class="line">	cs_mode mode;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span>* comment;</span><br><span class="line">	cs_opt_type opt_type;</span><br><span class="line">	cs_opt_value opt_value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_string_hex</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* str, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* c;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Code: "</span>);</span><br><span class="line">	<span class="keyword">for</span> (c = str; c &lt; str + len; c++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, *c &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE64 <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00\xe9\xea\xbe\xad\xde\xff\x25\x23\x01\x00\x00\xe8\xdf\xbe\xad\xde\x74\xff"</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform</span> <span class="title">platforms</span>[] = &#123;</span></span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_64,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE64,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE64) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 64 (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	csh handle;</span><br><span class="line">	<span class="keyword">uint64_t</span> address;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	cs_detail* detail;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	cs_err err;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">	cs_x86* x86;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(platforms) / <span class="keyword">sizeof</span>(platforms[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"****************\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Platform: %s\n"</span>, platforms[i].comment);</span><br><span class="line">		err = cs_open(platforms[i].arch, platforms[i].mode, &amp;handle);</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Failed on cs_open() with error returned: %u\n"</span>, err);</span><br><span class="line">			<span class="built_in">abort</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (platforms[i].opt_type)</span><br><span class="line">			cs_option(handle, platforms[i].opt_type, platforms[i].opt_value);</span><br><span class="line"></span><br><span class="line">		cs_option(handle, CS_OPT_DETAIL, CS_OPT_ON);</span><br><span class="line"></span><br><span class="line">		insn = cs_malloc(handle);</span><br><span class="line">		x86 = &amp;(insn-&gt;detail-&gt;x86);</span><br><span class="line">		print_string_hex(platforms[i].code, platforms[i].size);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Disasm:\n"</span>);</span><br><span class="line"></span><br><span class="line">		address = <span class="number">0x1000</span>;</span><br><span class="line">		code = platforms[i].code;</span><br><span class="line">		size = platforms[i].size;</span><br><span class="line">		<span class="keyword">while</span> (cs_disasm_iter(handle, &amp;code, &amp;size, &amp;address, insn)) &#123;</span><br><span class="line">			<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span> PRIx64 <span class="string">":\t%s\t\t%s          "</span>,</span><br><span class="line">				insn-&gt;address, insn-&gt;mnemonic, insn-&gt;op_str);</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">			count = cs_op_count(handle, insn, X86_OP_IMM);  <span class="comment">//查找立即数</span></span><br><span class="line">			<span class="keyword">if</span> (count) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"\timm_count: %u\n"</span>, count);</span><br><span class="line">				<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; count + <span class="number">1</span>; i++) &#123;</span><br><span class="line">					<span class="keyword">int</span> index = cs_op_index(handle, insn, X86_OP_IMM, i);</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\timms[%u]: 0x%"</span> PRIx64 <span class="string">"\n"</span>, i, x86-&gt;operands[index].imm);</span><br><span class="line">					<span class="keyword">if</span> (x86-&gt;encoding.imm_offset != <span class="number">0</span>) &#123;</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">"\timm_offset: 0x%x\n"</span>, x86-&gt;encoding.imm_offset);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> (x86-&gt;encoding.imm_size != <span class="number">0</span>) &#123;</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">"\timm_size: 0x%x\n"</span>, x86-&gt;encoding.imm_size);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">		cs_free(insn, <span class="number">1</span>);</span><br><span class="line">		cs_close(&amp;handle);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	test();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>输出<br><a href="https://i.loli.net/2019/07/27/5d3c45bfef22464773.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c45bfef22464773.jpg" class="lazyload" title></a></p>
<h3 id="cs-regs-access"><a href="#cs-regs-access" class="headerlink" title="cs_regs_access"></a>cs_regs_access</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">cs_err CAPSTONE_API <span class="title">cs_regs_access</span><span class="params">(csh handle, <span class="keyword">const</span> cs_insn *insn,</span></span></span><br><span class="line"><span class="function"><span class="params">		cs_regs regs_read, <span class="keyword">uint8_t</span> *regs_read_count,</span></span></span><br><span class="line"><span class="function"><span class="params">		cs_regs regs_write, <span class="keyword">uint8_t</span> *regs_write_count)</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>检索由一条指令显式或隐式访问的所有寄存器。</p>
<p>注意： 在“diet”模式下，此API不可用，因为引擎不存储寄存器。</p>
<p>handle: cs_open()返回的句柄<br>insn: 从cs_disasm()或cs_disasm_iter()返回的反汇编指令结构<br>regs_read:返回时，这个数组包含所有按指令读取的寄存器。<br>regs_read_count:保存在regs_read数组中的寄存器数。<br>regs_write:返回时，这个数组包含所有由指令修改的寄存器。<br>regs_write_count:保存在regs_write数组中的寄存器数。<br>成功时返回CS_ERR_OK，失败时返回其他值(详细错误请参阅cs_err enum)。</p>
<p>代码实现</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">cs_err CAPSTONE_API <span class="title">cs_regs_access</span><span class="params">(csh ud, <span class="keyword">const</span> cs_insn *insn,</span></span></span><br><span class="line"><span class="function"><span class="params">		cs_regs regs_read, <span class="keyword">uint8_t</span> *regs_read_count,</span></span></span><br><span class="line"><span class="function"><span class="params">		cs_regs regs_write, <span class="keyword">uint8_t</span> *regs_write_count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">handle</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!ud)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	handle = (struct cs_struct *)(<span class="keyword">uintptr_t</span>)ud;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CAPSTONE_DIET</span></span><br><span class="line">	<span class="comment">// This API does not work in DIET mode</span></span><br><span class="line">	handle-&gt;errnum = CS_ERR_DIET;</span><br><span class="line">	<span class="keyword">return</span> CS_ERR_DIET;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	<span class="keyword">if</span> (!handle-&gt;detail) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_DETAIL;</span><br><span class="line">		<span class="keyword">return</span> CS_ERR_DETAIL;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!insn-&gt;id) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_SKIPDATA;</span><br><span class="line">		<span class="keyword">return</span> CS_ERR_SKIPDATA;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!insn-&gt;detail) &#123;</span><br><span class="line">		handle-&gt;errnum = CS_ERR_DETAIL;</span><br><span class="line">		<span class="keyword">return</span> CS_ERR_DETAIL;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (handle-&gt;reg_access) &#123;</span><br><span class="line">		handle-&gt;reg_access(insn, regs_read, regs_read_count, regs_write, regs_write_count);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// this arch is unsupported yet</span></span><br><span class="line">		handle-&gt;errnum = CS_ERR_ARCH;</span><br><span class="line">		<span class="keyword">return</span> CS_ERR_ARCH;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">platform</span> &#123;</span></span><br><span class="line">	cs_arch arch;</span><br><span class="line">	cs_mode mode;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span>* comment;</span><br><span class="line">	cs_opt_type opt_type;</span><br><span class="line">	cs_opt_value opt_value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print_string_hex</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* str, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* c;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Code: "</span>);</span><br><span class="line">	<span class="keyword">for</span> (c = str; c &lt; str + len; c++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, *c &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> X86_CODE64 <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00\xe9\xea\xbe\xad\xde\xff\x25\x23\x01\x00\x00\xe8\xdf\xbe\xad\xde\x74\xff"</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">platform</span> <span class="title">platforms</span>[] = &#123;</span></span><br><span class="line">		&#123;</span><br><span class="line">			CS_ARCH_X86,</span><br><span class="line">			CS_MODE_64,</span><br><span class="line">			(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)X86_CODE64,</span><br><span class="line">			<span class="keyword">sizeof</span>(X86_CODE64) - <span class="number">1</span>,</span><br><span class="line">			<span class="string">"X86 64 (Intel syntax)"</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	csh handle;</span><br><span class="line">	<span class="keyword">uint64_t</span> address;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	cs_detail* detail;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	cs_err err;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span>* code;</span><br><span class="line">	<span class="keyword">size_t</span> size;</span><br><span class="line"></span><br><span class="line">	cs_x86* x86;</span><br><span class="line">	cs_regs regs_read, regs_write;</span><br><span class="line">	<span class="keyword">uint8_t</span> regs_read_count, regs_write_count;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(platforms) / <span class="keyword">sizeof</span>(platforms[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"****************\n"</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Platform: %s\n"</span>, platforms[i].comment);</span><br><span class="line">		err = cs_open(platforms[i].arch, platforms[i].mode, &amp;handle);</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Failed on cs_open() with error returned: %u\n"</span>, err);</span><br><span class="line">			<span class="built_in">abort</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (platforms[i].opt_type)</span><br><span class="line">			cs_option(handle, platforms[i].opt_type, platforms[i].opt_value);</span><br><span class="line"></span><br><span class="line">		cs_option(handle, CS_OPT_DETAIL, CS_OPT_ON);</span><br><span class="line"></span><br><span class="line">		insn = cs_malloc(handle);</span><br><span class="line">		x86 = &amp;(insn-&gt;detail-&gt;x86);</span><br><span class="line">		print_string_hex(platforms[i].code, platforms[i].size);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"Disasm:\n"</span>);</span><br><span class="line"></span><br><span class="line">		address = <span class="number">0x1000</span>;</span><br><span class="line">		code = platforms[i].code;</span><br><span class="line">		size = platforms[i].size;</span><br><span class="line">		<span class="keyword">while</span> (cs_disasm_iter(handle, &amp;code, &amp;size, &amp;address, insn)) &#123;</span><br><span class="line">			<span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span> PRIx64 <span class="string">":\t%s\t\t%s          "</span>,</span><br><span class="line">				insn-&gt;address, insn-&gt;mnemonic, insn-&gt;op_str);</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (!cs_regs_access(handle, insn,       <span class="comment">//每条指令所有读取和修改的寄存器</span></span><br><span class="line">				regs_read, &amp;regs_read_count,</span><br><span class="line">				regs_write, &amp;regs_write_count)) &#123;</span><br><span class="line">				<span class="keyword">if</span> (regs_read_count) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\tRegisters read:"</span>);</span><br><span class="line">					<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; regs_read_count; i++) &#123;</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">" %s"</span>, cs_reg_name(handle, regs_read[i]));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (regs_write_count) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\tRegisters modified:"</span>);</span><br><span class="line">					<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; regs_write_count; i++) &#123;</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">" %s"</span>, cs_reg_name(handle, regs_write[i]));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">		cs_free(insn, <span class="number">1</span>);</span><br><span class="line">		cs_close(&amp;handle);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	test();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>输出<br><a href="https://i.loli.net/2019/07/27/5d3c48d04fea172636.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/27/5d3c48d04fea172636.jpg" class="lazyload" title></a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">kabeor</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E5%9B%9B)/">https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E5%9B%9B)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kabeor.github.io">K's House</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8F%8D%E6%B1%87%E7%BC%96/">反汇编    </a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2018/07/16/5b4c6341c0e72.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019%E6%B9%96%E6%B9%98%E6%9D%AF%E7%BA%BF%E4%B8%8ARE%20WriteUp/"><img class="prev_cover lazyload" data-src="https://i.loli.net/2018/07/16/5b4c6273790c1.png" onerror="onerror=null;src='/img/404.png'"><div class="label">上一篇</div><div class="prev_info"><span>2019湖湘杯线上 RE WriteUp</span></div></a></div><div class="next-post pull_right"><a href="/2018%E6%8A%A4%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8A%20APM233/"><img class="next_cover lazyload" data-src="https://i.loli.net/2018/07/16/5b4c62735d971.png" onerror="onerror=null;src='/img/404.png'"><div class="label">下一篇</div><div class="next_info"><span>2018护网杯线上 APM233</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/Capstone反汇编引擎数据类型及API分析及示例(一)/" title="Capstone反汇编引擎数据类型及API分析及示例(一)"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2018/07/16/5b4c62738929d.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-07-26</div><div class="relatedPosts_title">Capstone反汇编引擎数据类型及API分析及示例(一)</div></div></a></div><div class="relatedPosts_item"><a href="/Capstone反汇编引擎数据类型及API分析及示例(三)/" title="Capstone反汇编引擎数据类型及API分析及示例(三)"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2018/07/16/5b4c6341ac665.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-07-29</div><div class="relatedPosts_title">Capstone反汇编引擎数据类型及API分析及示例(三)</div></div></a></div><div class="relatedPosts_item"><a href="/Capstone反汇编引擎数据类型及API分析及示例(二)/" title="Capstone反汇编引擎数据类型及API分析及示例(二)"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2018/07/16/5b4c62f90e035.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-07-27</div><div class="relatedPosts_title">Capstone反汇编引擎数据类型及API分析及示例(二)</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = true == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'53gELcU5PPzXKUh1q21E5Nkh-gzGzoHsz',
  appKey:'pSNnuMbRDkWAE7j44yChrEce',
  placeholder:'请到 https://gitter.im/K-s-House/community 进行评论(╯‵□′)╯︵┻━┻',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(https://i.loli.net/2018/07/16/5b4c6341c0e72.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2020 By kabeor</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>