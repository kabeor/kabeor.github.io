<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Capstone反汇编引擎数据类型及API分析及示例(三) | K's House</title><meta name="description" content="Capstone反汇编引擎数据类型及API分析及示例(三)"><meta name="keywords" content="反汇编"><meta name="author" content="kabeor"><meta name="copyright" content="kabeor"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Capstone反汇编引擎数据类型及API分析及示例(三)"><meta name="twitter:description" content="Capstone反汇编引擎数据类型及API分析及示例(三)"><meta name="twitter:image" content="https://i.loli.net/2018/07/16/5b4c6341ac665.png"><meta property="og:type" content="article"><meta property="og:title" content="Capstone反汇编引擎数据类型及API分析及示例(三)"><meta property="og:url" content="https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%B8%89)/"><meta property="og:site_name" content="K's House"><meta property="og:description" content="Capstone反汇编引擎数据类型及API分析及示例(三)"><meta property="og:image" content="https://i.loli.net/2018/07/16/5b4c6341ac665.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%B8%89)/"><link rel="prev" title="逆向分析加解密之TwoFish算法" href="https://kabeor.github.io/%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%B9%8BTwoFish%E7%AE%97%E6%B3%95/"><link rel="next" title="Capstone反汇编引擎数据类型及API分析及示例(二)" href="https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%BA%8C)/"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-113413523-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">K's House</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://kabeor.cn/img/avatarme.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">125</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">67</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">30</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Capstone反汇编引擎数据类型及API分析及示例-三"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Capstone反汇编引擎数据类型及API分析及示例(三)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#API分析"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">API分析</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-open"><span class="toc_mobile_items-number">1.1.1.</span> <span class="toc_mobile_items-text">cs_open</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-close"><span class="toc_mobile_items-number">1.1.2.</span> <span class="toc_mobile_items-text">cs_close</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-option"><span class="toc_mobile_items-number">1.1.3.</span> <span class="toc_mobile_items-text">cs_option</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-errno"><span class="toc_mobile_items-number">1.1.4.</span> <span class="toc_mobile_items-text">cs_errno</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-strerror"><span class="toc_mobile_items-number">1.1.5.</span> <span class="toc_mobile_items-text">cs_strerror</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#cs-disasm"><span class="toc_mobile_items-number">1.1.6.</span> <span class="toc_mobile_items-text">cs_disasm</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Capstone反汇编引擎数据类型及API分析及示例-三"><span class="toc-number">1.</span> <span class="toc-text">Capstone反汇编引擎数据类型及API分析及示例(三)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#API分析"><span class="toc-number">1.1.</span> <span class="toc-text">API分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-open"><span class="toc-number">1.1.1.</span> <span class="toc-text">cs_open</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-close"><span class="toc-number">1.1.2.</span> <span class="toc-text">cs_close</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-option"><span class="toc-number">1.1.3.</span> <span class="toc-text">cs_option</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-errno"><span class="toc-number">1.1.4.</span> <span class="toc-text">cs_errno</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-strerror"><span class="toc-number">1.1.5.</span> <span class="toc-text">cs_strerror</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cs-disasm"><span class="toc-number">1.1.6.</span> <span class="toc-text">cs_disasm</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2018/07/16/5b4c6341ac665.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Capstone反汇编引擎数据类型及API分析及示例(三)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-07-29<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-03-16</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%80%86%E5%90%91/">逆向</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.9k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 14 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%B8%89)/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%B8%89)/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Capstone反汇编引擎数据类型及API分析及示例-三"><a href="#Capstone反汇编引擎数据类型及API分析及示例-三" class="headerlink" title="Capstone反汇编引擎数据类型及API分析及示例(三)"></a>Capstone反汇编引擎数据类型及API分析及示例(三)</h1><blockquote>
<p>本文由本人首发于先知社区 <a href="https://xz.aliyun.com/t/5772" target="_blank" rel="noopener">https://xz.aliyun.com/t/5772</a></p>
</blockquote>
<h2 id="API分析"><a href="#API分析" class="headerlink" title="API分析"></a>API分析</h2><h3 id="cs-open"><a href="#cs-open" class="headerlink" title="cs_open"></a>cs_open</h3><p><code>cs_err CAPSTONE_API cs_open(cs_arch arch, cs_mode mode, csh *handle);</code></p>
<p>初始化cs句柄</p>
<p>参数<br>arch: 架构类型 (CS_ARCH_<em>)<br>mode: 硬件模式. CS_MODE_</em>在cs_mode数据类型中可查<br>handle: 指向句柄, 返回时更新<br>return: 创建成功返回CS_ERR_OK，否则返回cs_err枚举中对应的错误信息</p>
<p>实现代码</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">cs_err CAPSTONE_API <span class="title">cs_open</span><span class="params">(cs_arch arch, cs_mode mode, csh *handle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cs_err err;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">ud</span>;</span></span><br><span class="line">	<span class="keyword">if</span> (!cs_mem_malloc || !cs_mem_calloc || !cs_mem_realloc || !cs_mem_free || !cs_vsnprintf)</span><br><span class="line">		<span class="comment">// Error: 使用cs_open()前, 必须使用cs_option(CS_OPT_MEM)进行动态内存管理的初始化</span></span><br><span class="line">		<span class="keyword">return</span> CS_ERR_MEMSETUP;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (arch &lt; CS_ARCH_MAX &amp;&amp; cs_arch_init[arch]) &#123;</span><br><span class="line">		<span class="comment">// 验证架构是否使用，方式：架构在枚举中且可初始化</span></span><br><span class="line">		<span class="keyword">if</span> (mode &amp; cs_arch_disallowed_mode_mask[arch]) &#123;</span><br><span class="line">			*handle = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">return</span> CS_ERR_MODE;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ud = cs_mem_calloc(<span class="number">1</span>, <span class="keyword">sizeof</span>(*ud));</span><br><span class="line">		<span class="keyword">if</span> (!ud) &#123;</span><br><span class="line">			<span class="comment">// 内存不足</span></span><br><span class="line">			<span class="keyword">return</span> CS_ERR_MEM;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ud-&gt;errnum = CS_ERR_OK;</span><br><span class="line">		ud-&gt;arch = arch;</span><br><span class="line">		ud-&gt;mode = mode;</span><br><span class="line">		<span class="comment">// 默认情况指令不打开detail模式</span></span><br><span class="line">		ud-&gt;detail = CS_OPT_OFF;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 默认skipdata设置</span></span><br><span class="line">		ud-&gt;skipdata_setup.mnemonic = SKIPDATA_MNEM;</span><br><span class="line"></span><br><span class="line">		err = cs_arch_init[ud-&gt;arch](ud);</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			cs_mem_free(ud);</span><br><span class="line">			*handle = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">return</span> err;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		*handle = (<span class="keyword">uintptr_t</span>)ud;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		*handle = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> CS_ERR_ARCH;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>其中，cs_struct结构体包含更多细节设定，如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> &#123;</span></span><br><span class="line">	cs_arch arch;</span><br><span class="line">	cs_mode mode;</span><br><span class="line">	Printer_t printer;	<span class="comment">// 打印asm</span></span><br><span class="line">	<span class="keyword">void</span> *printer_info; <span class="comment">// 打印信息</span></span><br><span class="line">	Disasm_t disasm;	<span class="comment">// 反编译</span></span><br><span class="line">	<span class="keyword">void</span> *getinsn_info; <span class="comment">// 打印辅助信息</span></span><br><span class="line">	GetName_t reg_name;</span><br><span class="line">	GetName_t insn_name;</span><br><span class="line">	GetName_t group_name;</span><br><span class="line">	GetID_t insn_id;</span><br><span class="line">	PostPrinter_t post_printer;</span><br><span class="line">	cs_err errnum;</span><br><span class="line">	ARM_ITStatus ITBlock;	<span class="comment">// ARM特殊选项</span></span><br><span class="line">	cs_opt_value detail, imm_unsigned;</span><br><span class="line">	<span class="keyword">int</span> syntax;	<span class="comment">//ARM, Mips &amp; PPC等架构的基本asm语法打印</span></span><br><span class="line">	<span class="keyword">bool</span> doing_mem;	<span class="comment">// 在InstPrinter代码中处理内存操作数</span></span><br><span class="line">	<span class="keyword">unsigned</span> short *insn_cache;	<span class="comment">//为mapping.c建立缓存索引</span></span><br><span class="line">	GetRegisterName_t get_regname;</span><br><span class="line">	<span class="keyword">bool</span> skipdata;	<span class="comment">// 如果反编译时要跳过数据，该项设置为True</span></span><br><span class="line">	<span class="keyword">uint8_t</span> skipdata_size;	<span class="comment">//要跳过bytes的数量</span></span><br><span class="line">	cs_opt_skipdata skipdata_setup;	<span class="comment">// 自定义skipdata设置</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span> *regsize_map;	<span class="comment">//映射register大小 (目前仅支持x86)</span></span><br><span class="line">	GetRegisterAccess_t reg_access;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">insn_mnem</span> *<span class="title">mnem_list</span>;</span>	<span class="comment">// 自定义指令助记符的链接list</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>示例(创建一个x86_64类型的cs句柄)：<br><code>cs_open(CS_ARCH_X86, CS_MODE_64, &amp;handle)</code></p>
<h3 id="cs-close"><a href="#cs-close" class="headerlink" title="cs_close"></a>cs_close</h3><p><code>cs_err CAPSTONE_API cs_close(csh *handle);</code></p>
<p>释放句柄<br>参数<br>handle: 指向一个cs_open()打开的句柄<br>return: 释放成功返回CS_ERR_OK,否则返回cs_err枚举的错误信息</p>
<p>实现代码，可以看出释放句柄实质为将句柄值设置为0</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">cs_err CAPSTONE_API <span class="title">cs_close</span><span class="params">(csh *handle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">ud</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">insn_mnem</span> *<span class="title">next</span>, *<span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (*handle == <span class="number">0</span>)</span><br><span class="line">		<span class="comment">// 句柄不可用</span></span><br><span class="line">		<span class="keyword">return</span> CS_ERR_CSH;</span><br><span class="line"></span><br><span class="line">	ud = (struct cs_struct *)(*handle);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (ud-&gt;printer_info)</span><br><span class="line">		cs_mem_free(ud-&gt;printer_info);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 释放自定义助记符的链接list</span></span><br><span class="line">	tmp = ud-&gt;mnem_list;</span><br><span class="line">	<span class="keyword">while</span>(tmp) &#123;</span><br><span class="line">		next = tmp-&gt;next;</span><br><span class="line">		cs_mem_free(tmp);</span><br><span class="line">		tmp = next;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cs_mem_free(ud-&gt;insn_cache);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(ud, <span class="number">0</span>, <span class="keyword">sizeof</span>(*ud));</span><br><span class="line">	cs_mem_free(ud);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// handle值设置为0，保证这个句柄在cs_close()释放后不可使用</span></span><br><span class="line">	*handle = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>示例：<br><code>cs_close(&amp;handle);</code></p>
<h3 id="cs-option"><a href="#cs-option" class="headerlink" title="cs_option"></a>cs_option</h3><p><code>cs_err CAPSTONE_API cs_option(csh handle, cs_opt_type type, size_t value);</code></p>
<p>反编译引擎的运行时选项</p>
<p>handle: cs_open()打开的句柄<br>type: 设置选项的类型<br>value: 与type对应的选项值<br>return: 设置成功返回CS_ERR_OK,否则返回cs_err枚举的错误信息</p>
<p>注意: 在CS_OPT_MEM的情况下，handle可以是任何值，因此cs_option(handle, CS_OPT_MEM, value)必须在cs_open()之前被调用</p>
<p>实现代码</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">cs_err CAPSTONE_API <span class="title">cs_option</span><span class="params">(csh ud, cs_opt_type type, <span class="keyword">size_t</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">handle</span>;</span></span><br><span class="line">	cs_opt_mnem *opt;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 支持在所有API前支持 (even cs_open())</span></span><br><span class="line">	<span class="keyword">if</span> (type == CS_OPT_MEM) &#123;</span><br><span class="line">		cs_opt_mem *mem = (cs_opt_mem *)value;</span><br><span class="line"></span><br><span class="line">		cs_mem_malloc = mem-&gt;<span class="built_in">malloc</span>;</span><br><span class="line">		cs_mem_calloc = mem-&gt;<span class="built_in">calloc</span>;</span><br><span class="line">		cs_mem_realloc = mem-&gt;<span class="built_in">realloc</span>;</span><br><span class="line">		cs_mem_free = mem-&gt;<span class="built_in">free</span>;</span><br><span class="line">		cs_vsnprintf = mem-&gt;vsnprintf;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	handle = (struct cs_struct *)(<span class="keyword">uintptr_t</span>)ud;</span><br><span class="line">	<span class="keyword">if</span> (!handle)</span><br><span class="line">		<span class="keyword">return</span> CS_ERR_CSH;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span>(type) &#123;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> CS_OPT_UNSIGNED:</span><br><span class="line">			handle-&gt;imm_unsigned = (cs_opt_value)value;</span><br><span class="line">			<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> CS_OPT_DETAIL:</span><br><span class="line">			handle-&gt;detail = (cs_opt_value)value;</span><br><span class="line">			<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> CS_OPT_SKIPDATA:</span><br><span class="line">			handle-&gt;skipdata = (value == CS_OPT_ON);</span><br><span class="line">			<span class="keyword">if</span> (handle-&gt;skipdata) &#123;</span><br><span class="line">				<span class="keyword">if</span> (handle-&gt;skipdata_size == <span class="number">0</span>) &#123;</span><br><span class="line">					handle-&gt;skipdata_size = skipdata_size(handle);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> CS_OPT_SKIPDATA_SETUP:</span><br><span class="line">			<span class="keyword">if</span> (value)</span><br><span class="line">				handle-&gt;skipdata_setup = *((cs_opt_skipdata *)value);</span><br><span class="line">			<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> CS_OPT_MNEMONIC:</span><br><span class="line">			opt = (cs_opt_mnem *)value;</span><br><span class="line">			<span class="keyword">if</span> (opt-&gt;id) &#123;</span><br><span class="line">				<span class="keyword">if</span> (opt-&gt;mnemonic) &#123;</span><br><span class="line">					<span class="class"><span class="keyword">struct</span> <span class="title">insn_mnem</span> *<span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line">					<span class="comment">// 添加新指令或替换现有指令</span></span><br><span class="line">					<span class="comment">// 查看当前insn释放在list中</span></span><br><span class="line">					tmp = handle-&gt;mnem_list;</span><br><span class="line">					<span class="keyword">while</span>(tmp) &#123;</span><br><span class="line">						<span class="keyword">if</span> (tmp-&gt;insn.id == opt-&gt;id) &#123;</span><br><span class="line">							<span class="comment">// f找到指令，替换助记符</span></span><br><span class="line">							(<span class="keyword">void</span>)<span class="built_in">strncpy</span>(tmp-&gt;insn.mnemonic, opt-&gt;mnemonic, <span class="keyword">sizeof</span>(tmp-&gt;insn.mnemonic) - <span class="number">1</span>);</span><br><span class="line">							tmp-&gt;insn.mnemonic[<span class="keyword">sizeof</span>(tmp-&gt;insn.mnemonic) - <span class="number">1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">							<span class="keyword">break</span>;</span><br><span class="line">						&#125;</span><br><span class="line">						tmp = tmp-&gt;next;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 2. 如果没有就添加这条指令</span></span><br><span class="line">					<span class="keyword">if</span> (!tmp) &#123;</span><br><span class="line">						tmp = cs_mem_malloc(<span class="keyword">sizeof</span>(*tmp));</span><br><span class="line">						tmp-&gt;insn.id = opt-&gt;id;</span><br><span class="line">						(<span class="keyword">void</span>)<span class="built_in">strncpy</span>(tmp-&gt;insn.mnemonic, opt-&gt;mnemonic, <span class="keyword">sizeof</span>(tmp-&gt;insn.mnemonic) - <span class="number">1</span>);</span><br><span class="line">						tmp-&gt;insn.mnemonic[<span class="keyword">sizeof</span>(tmp-&gt;insn.mnemonic) - <span class="number">1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">						<span class="comment">// 新指令放在list最前面</span></span><br><span class="line">						tmp-&gt;next = handle-&gt;mnem_list;</span><br><span class="line">						handle-&gt;mnem_list = tmp;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					struct insn_mnem *prev, *tmp;</span><br><span class="line"></span><br><span class="line">					tmp = handle-&gt;mnem_list;</span><br><span class="line">					prev = tmp;</span><br><span class="line">					<span class="keyword">while</span>(tmp) &#123;</span><br><span class="line">						<span class="keyword">if</span> (tmp-&gt;insn.id == opt-&gt;id) &#123;</span><br><span class="line">							<span class="comment">// 删除指令</span></span><br><span class="line">							<span class="keyword">if</span> (tmp == prev) &#123;</span><br><span class="line">								handle-&gt;mnem_list = tmp-&gt;next;</span><br><span class="line">							&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">								prev-&gt;next = tmp-&gt;next;</span><br><span class="line">							&#125;</span><br><span class="line">							cs_mem_free(tmp);</span><br><span class="line">							<span class="keyword">break</span>;</span><br><span class="line">						&#125;</span><br><span class="line">						prev = tmp;</span><br><span class="line">						tmp = tmp-&gt;next;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> CS_OPT_MODE:</span><br><span class="line">			<span class="comment">// 验证所请求的模式是否有效</span></span><br><span class="line">			<span class="keyword">if</span> (value &amp; cs_arch_disallowed_mode_mask[handle-&gt;arch]) &#123;</span><br><span class="line">				<span class="keyword">return</span> CS_ERR_OPTION;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> cs_arch_option[handle-&gt;arch](handle, type, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


<p>示例，更改反汇编后显示的语法：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CODE <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	csh handle;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	<span class="keyword">size_t</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cs_open(CS_ARCH_X86, CS_MODE_64, &amp;handle)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"ERROR: Failed to initialize engine!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	cs_option(handle, CS_OPT_SYNTAX, CS_OPT_SYNTAX_ATT);  <span class="comment">// 以AT&amp;T语法显示</span></span><br><span class="line">	count = cs_disasm(handle, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)CODE, <span class="keyword">sizeof</span>(CODE) - <span class="number">1</span>, <span class="number">0x1000</span>, <span class="number">0</span>, &amp;insn);</span><br><span class="line">	<span class="keyword">if</span> (count) &#123;</span><br><span class="line">		<span class="keyword">size_t</span> j;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; count; j++) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span><span class="string">"Ix"</span><span class="string">":\t%s\t\t%s\n"</span>, insn[j].address, insn[j].mnemonic, insn[j].op_str);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		cs_free(insn, count);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"ERROR: Failed to disassemble given code!\n"</span>);</span><br><span class="line"></span><br><span class="line">	cs_close(&amp;handle);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出</p>
<p><a href="https://i.loli.net/2019/07/22/5d35b1e72c20515640.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/22/5d35b1e72c20515640.jpg" class="lazyload" title></a></p>
<h3 id="cs-errno"><a href="#cs-errno" class="headerlink" title="cs_errno"></a>cs_errno</h3><p><code>cs_err CAPSTONE_API cs_errno(csh handle);</code></p>
<p>API出错时返回错误消息<br>参数<br>handle: cs_open()打开的句柄<br>return: 无错误返回CS_ERR_OK,否则返回cs_err枚举的错误信息</p>
<p>实现很简单，判断到句柄不存在直接返回CS_ERR_CSH</p>
<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CODE <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	csh handle = <span class="number">0</span>;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	<span class="keyword">size_t</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cs_open(CS_ARCH_X86, CS_MODE_64, &amp;handle)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"ERROR: Failed to initialize engine!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cs_close(&amp;handle);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; cs_errno(handle);    <span class="comment">//关闭句柄后检查将报错</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出，错误码4即CS_ERR_CSH<br><a href="https://i.loli.net/2019/07/22/5d35bad79c9c384228.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/22/5d35bad79c9c384228.jpg" class="lazyload" title></a></p>
<h3 id="cs-strerror"><a href="#cs-strerror" class="headerlink" title="cs_strerror"></a>cs_strerror</h3><p><code>const char * CAPSTONE_API cs_strerror(cs_err code);</code></p>
<p>将上个API输出的错误码转换为详细错误信息</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> * CAPSTONE_API <span class="title">cs_strerror</span><span class="params">(cs_err code)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(code) &#123;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Unknown error code"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_OK:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"OK (CS_ERR_OK)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_MEM:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Out of memory (CS_ERR_MEM)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_ARCH:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Invalid/unsupported architecture(CS_ERR_ARCH)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_HANDLE:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Invalid handle (CS_ERR_HANDLE)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_CSH:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Invalid csh (CS_ERR_CSH)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_MODE:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Invalid mode (CS_ERR_MODE)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_OPTION:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Invalid option (CS_ERR_OPTION)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_DETAIL:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Details are unavailable (CS_ERR_DETAIL)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_MEMSETUP:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Dynamic memory management uninitialized (CS_ERR_MEMSETUP)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_VERSION:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Different API version between core &amp; binding (CS_ERR_VERSION)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_DIET:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Information irrelevant in diet engine (CS_ERR_DIET)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_SKIPDATA:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Information irrelevant for 'data' instruction in SKIPDATA mode (CS_ERR_SKIPDATA)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_X86_ATT:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"AT&amp;T syntax is unavailable (CS_ERR_X86_ATT)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_X86_INTEL:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"INTEL syntax is unavailable (CS_ERR_X86_INTEL)"</span>;</span><br><span class="line">		<span class="keyword">case</span> CS_ERR_X86_MASM:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"MASM syntax is unavailable (CS_ERR_X86_MASM)"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>示例，结合cs_errno使用：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CODE <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	csh handle = <span class="number">0</span>;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	<span class="keyword">size_t</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cs_open(CS_ARCH_X86, CS_MODE_64, &amp;handle)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"ERROR: Failed to initialize engine!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cs_close(&amp;handle);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; cs_strerror(cs_errno(handle));  <span class="comment">//直接输出报错信息</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出<br><a href="https://i.loli.net/2019/07/22/5d35bc1db170a33360.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/22/5d35bc1db170a33360.jpg" class="lazyload" title></a></p>
<h3 id="cs-disasm"><a href="#cs-disasm" class="headerlink" title="cs_disasm"></a>cs_disasm</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">c</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> CAPSTONE_API <span class="title">cs_disasm</span><span class="params">(csh handle,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">const</span> <span class="keyword">uint8_t</span> *code, <span class="keyword">size_t</span> code_size,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">uint64_t</span> address,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">size_t</span> count,</span></span></span><br><span class="line"><span class="function"><span class="params">		cs_insn **insn)</span></span>;</span><br></pre></td></tr></table></figure></div>

<p>给定缓冲区、大小、地址和编号，反编译机器码<br>API动态地分配内存来包含分解的指令，生成的指令将放在*insn中</p>
<p>注意： 必须释放分配的内存，以避免内存泄漏。对于需要动态分配稀缺内存的系统(如OS内核或固件)，API cs_disasm_iter()可能是比cs_disasm()更好的选择。原因是，使用cs_disasm()时，基于有限的可用内存，必须预先计算要分解多少条指令。</p>
<p>handle: cs_open()返回的句柄<br>code: 包含要反汇编的机器码的缓冲区。<br>code_size:上面代码缓冲区的大小。<br>address:给定原始代码缓冲区中的第一条指令的地址。<br>insn: 由这个API填写的指令数组。注意: insn将由这个函数分配，应该用cs_free () API释放<br>count: 需要分解的指令数量，或输入0分解所有指令<br>return:成功反汇编指令的数量，如果该函数未能反汇编给定的代码，则为0，失败时，调用cs_errno()获取错误代码。</p>
<p>源码分析</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> CAPSTONE_API <span class="title">cs_disasm</span><span class="params">(csh ud, <span class="keyword">const</span> <span class="keyword">uint8_t</span> *buffer, <span class="keyword">size_t</span> size, <span class="keyword">uint64_t</span> offset, <span class="keyword">size_t</span> count, cs_insn **insn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cs_struct</span> *<span class="title">handle</span>;</span></span><br><span class="line">	MCInst mci;</span><br><span class="line">	<span class="keyword">uint16_t</span> insn_size;</span><br><span class="line">	<span class="keyword">size_t</span> c = <span class="number">0</span>, i;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> f = <span class="number">0</span>;	<span class="comment">// 缓存中下一条指令的索引</span></span><br><span class="line">	cs_insn *insn_cache;	<span class="comment">// 缓存反汇编后的指令</span></span><br><span class="line">	<span class="keyword">void</span> *total = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">size_t</span> total_size = <span class="number">0</span>;	<span class="comment">//所有insn的输出缓冲区的总大小</span></span><br><span class="line">	<span class="keyword">bool</span> r;</span><br><span class="line">	<span class="keyword">void</span> *tmp;</span><br><span class="line">	<span class="keyword">size_t</span> skipdata_bytes;</span><br><span class="line">	<span class="keyword">uint64_t</span> offset_org; <span class="comment">// 保存缓冲区的所有原始信息</span></span><br><span class="line">	<span class="keyword">size_t</span> size_org;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">uint8_t</span> *buffer_org;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> cache_size = INSN_CACHE_SIZE;</span><br><span class="line">	<span class="keyword">size_t</span> next_offset;</span><br><span class="line"></span><br><span class="line">	handle = (struct cs_struct *)(<span class="keyword">uintptr_t</span>)ud;</span><br><span class="line">	<span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">		<span class="comment">// 修复方式:</span></span><br><span class="line">		<span class="comment">// handle-&gt;errnum = CS_ERR_HANDLE;</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	handle-&gt;errnum = CS_ERR_OK;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 重设ARM架构的IT block</span></span><br><span class="line">	<span class="keyword">if</span> (handle-&gt;arch == CS_ARCH_ARM)</span><br><span class="line">		handle-&gt;ITBlock.size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CAPSTONE_USE_SYS_DYN_MEM</span></span><br><span class="line">	<span class="keyword">if</span> (count &gt; <span class="number">0</span> &amp;&amp; count &lt;= INSN_CACHE_SIZE)</span><br><span class="line">		cache_size = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) count;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 保存SKIPDATA原始偏移量</span></span><br><span class="line">	buffer_org = buffer;</span><br><span class="line">	offset_org = offset;</span><br><span class="line">	size_org = size;</span><br><span class="line"></span><br><span class="line">	total_size = <span class="keyword">sizeof</span>(cs_insn) * cache_size;</span><br><span class="line">	total = cs_mem_malloc(total_size);</span><br><span class="line">	<span class="keyword">if</span> (total == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="comment">// 内存不足</span></span><br><span class="line">		handle-&gt;errnum = CS_ERR_MEM;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	insn_cache = total;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		MCInst_Init(&amp;mci);</span><br><span class="line">		mci.csh = handle;</span><br><span class="line"></span><br><span class="line">		mci.address = offset;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (handle-&gt;detail) &#123;</span><br><span class="line">			<span class="comment">//给detail指针分配内存</span></span><br><span class="line">			insn_cache-&gt;detail = cs_mem_malloc(<span class="keyword">sizeof</span>(cs_detail));</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			insn_cache-&gt;detail = <span class="literal">NULL</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 为non-detailed模式保存所有信息</span></span><br><span class="line">		mci.flat_insn = insn_cache;</span><br><span class="line">		mci.flat_insn-&gt;address = offset;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CAPSTONE_DIET</span></span><br><span class="line">		<span class="comment">//mnemonic &amp; op_str0填充</span></span><br><span class="line">		mci.flat_insn-&gt;mnemonic[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line">		mci.flat_insn-&gt;op_str[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">		r = handle-&gt;disasm(ud, buffer, size, &amp;mci, &amp;insn_size, offset, handle-&gt;getinsn_info);</span><br><span class="line">		<span class="keyword">if</span> (r) &#123;</span><br><span class="line">			SStream ss;</span><br><span class="line">			SStream_Init(&amp;ss);</span><br><span class="line"></span><br><span class="line">			mci.flat_insn-&gt;size = insn_size;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//将内部指令操作码映射到公共insn ID</span></span><br><span class="line">			handle-&gt;insn_id(handle, insn_cache, mci.Opcode);</span><br><span class="line"></span><br><span class="line">			handle-&gt;printer(&amp;mci, &amp;ss, handle-&gt;printer_info);</span><br><span class="line">			fill_insn(handle, insn_cache, ss.buffer, &amp;mci, handle-&gt;post_printer, buffer);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 调整opcode (X86)</span></span><br><span class="line">			<span class="keyword">if</span> (handle-&gt;arch == CS_ARCH_X86)</span><br><span class="line">				insn_cache-&gt;id += mci.popcode_adjust;</span><br><span class="line"></span><br><span class="line">			next_offset = insn_size;</span><br><span class="line">		&#125; <span class="keyword">else</span>	&#123;</span><br><span class="line">			<span class="comment">// 遇到中断指令</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// 为detail指针释放内存</span></span><br><span class="line">			<span class="keyword">if</span> (handle-&gt;detail) &#123;</span><br><span class="line">				cs_mem_free(insn_cache-&gt;detail);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (!handle-&gt;skipdata || handle-&gt;skipdata_size &gt; size)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (handle-&gt;skipdata_setup.callback) &#123;</span><br><span class="line">				skipdata_bytes = handle-&gt;skipdata_setup.callback(buffer_org, size_org,</span><br><span class="line">						(<span class="keyword">size_t</span>)(offset - offset_org), handle-&gt;skipdata_setup.user_data);</span><br><span class="line">				<span class="keyword">if</span> (skipdata_bytes &gt; size)</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (!skipdata_bytes)</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span></span><br><span class="line">				skipdata_bytes = handle-&gt;skipdata_size;</span><br><span class="line"></span><br><span class="line">			insn_cache-&gt;id = <span class="number">0</span>;</span><br><span class="line">			insn_cache-&gt;address = offset;</span><br><span class="line">			insn_cache-&gt;size = (<span class="keyword">uint16_t</span>)skipdata_bytes;</span><br><span class="line">			<span class="built_in">memcpy</span>(insn_cache-&gt;bytes, buffer, skipdata_bytes);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CAPSTONE_DIET</span></span><br><span class="line">			insn_cache-&gt;mnemonic[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line">			insn_cache-&gt;op_str[<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">			<span class="built_in">strncpy</span>(insn_cache-&gt;mnemonic, handle-&gt;skipdata_setup.mnemonic,</span><br><span class="line">					<span class="keyword">sizeof</span>(insn_cache-&gt;mnemonic) - <span class="number">1</span>);</span><br><span class="line">			skipdata_opstr(insn_cache-&gt;op_str, buffer, skipdata_bytes);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">			insn_cache-&gt;detail = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">			next_offset = skipdata_bytes;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 一条新指令进入缓存</span></span><br><span class="line">		f++;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 反汇编了一条指令</span></span><br><span class="line">		c++;</span><br><span class="line">		<span class="keyword">if</span> (count &gt; <span class="number">0</span> &amp;&amp; c == count)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (f == cache_size) &#123;</span><br><span class="line">			cache_size = cache_size * <span class="number">8</span> / <span class="number">5</span>; </span><br><span class="line">			total_size += (<span class="keyword">sizeof</span>(cs_insn) * cache_size);</span><br><span class="line">			tmp = cs_mem_realloc(total, total_size);</span><br><span class="line">			<span class="keyword">if</span> (tmp == <span class="literal">NULL</span>) &#123;	<span class="comment">//内存不足</span></span><br><span class="line">				<span class="keyword">if</span> (handle-&gt;detail) &#123;</span><br><span class="line">					insn_cache = (cs_insn *)total;</span><br><span class="line">					<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; c; i++, insn_cache++)</span><br><span class="line">						cs_mem_free(insn_cache-&gt;detail);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				cs_mem_free(total);</span><br><span class="line">				*insn = <span class="literal">NULL</span>;</span><br><span class="line">				handle-&gt;errnum = CS_ERR_MEM;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			total = tmp;</span><br><span class="line">			<span class="comment">//在最后一条指令之后继续填充缓存</span></span><br><span class="line">			insn_cache = (cs_insn *)((<span class="keyword">char</span> *)total + <span class="keyword">sizeof</span>(cs_insn) * c);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 将f重置为0，从一开始就填入缓存</span></span><br><span class="line">			f = <span class="number">0</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span></span><br><span class="line">			insn_cache++;</span><br><span class="line"></span><br><span class="line">		buffer += next_offset;</span><br><span class="line">		size -= next_offset;</span><br><span class="line">		offset += next_offset;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!c) &#123;</span><br><span class="line">		<span class="comment">//未反汇编任何指令</span></span><br><span class="line">		cs_mem_free(total);</span><br><span class="line">		total = <span class="literal">NULL</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (f != cache_size) &#123;</span><br><span class="line">		<span class="comment">// 没有完全使用最后一个缓存，缩小大小</span></span><br><span class="line">		tmp = cs_mem_realloc(total, total_size - (cache_size - f) * <span class="keyword">sizeof</span>(*insn_cache));</span><br><span class="line">		<span class="keyword">if</span> (tmp == <span class="literal">NULL</span>) &#123;	<span class="comment">// 内存不足</span></span><br><span class="line">			<span class="comment">// 释放所有detail指针</span></span><br><span class="line">			<span class="keyword">if</span> (handle-&gt;detail) &#123;</span><br><span class="line">				insn_cache = (cs_insn *)total;</span><br><span class="line">				<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; c; i++, insn_cache++)</span><br><span class="line">					cs_mem_free(insn_cache-&gt;detail);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			cs_mem_free(total);</span><br><span class="line">			*insn = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">			handle-&gt;errnum = CS_ERR_MEM;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		total = tmp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	*insn = total;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>示例，x86_64:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">cpp</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"capstone.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"platform.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CODE <span class="meta-string">"\x55\x48\x8b\x05\xb8\x13\x00\x00\xe9\xea\xbe\xad\xde\xff\x25\x23\x01\x00\x00\xe8\xdf\xbe\xad\xde\x74\xff"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	csh handle = <span class="number">0</span>;</span><br><span class="line">	cs_insn* insn;</span><br><span class="line">	<span class="keyword">size_t</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (cs_open(CS_ARCH_X86, CS_MODE_64, &amp;handle)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"ERROR: Failed to initialize engine!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	count = cs_disasm(handle, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)CODE, <span class="keyword">sizeof</span>(CODE) - <span class="number">1</span>, <span class="number">0x1000</span>, <span class="number">0</span>, &amp;insn);   <span class="comment">//所有指令，基址0x1000，放入insn</span></span><br><span class="line">	<span class="keyword">if</span> (count) &#123;</span><br><span class="line">		<span class="keyword">size_t</span> j;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; count; j++) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"0x%"</span><span class="string">"Ix"</span><span class="string">":\t%s\t\t%s\n"</span>, insn[j].address, insn[j].mnemonic, insn[j].op_str);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		cs_free(insn, count);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"ERROR: Failed to disassemble given code!\n"</span>);</span><br><span class="line"></span><br><span class="line">	cs_close(&amp;handle);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>输出</p>
<p><a href="https://i.loli.net/2019/07/22/5d35c5087d17d31194.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt data-src="https://i.loli.net/2019/07/22/5d35c5087d17d31194.jpg" class="lazyload" title></a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">kabeor</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%B8%89)/">https://kabeor.github.io/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%B8%89)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kabeor.github.io">K's House</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8F%8D%E6%B1%87%E7%BC%96/">反汇编    </a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2018/07/16/5b4c6341ac665.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%8A%A0%E8%A7%A3%E5%AF%86%E4%B9%8BTwoFish%E7%AE%97%E6%B3%95/"><img class="prev_cover lazyload" data-src="https://i.loli.net/2018/07/16/5b4c6341bc8a9.png" onerror="onerror=null;src='/img/404.png'"><div class="label">上一篇</div><div class="prev_info"><span>逆向分析加解密之TwoFish算法</span></div></a></div><div class="next-post pull_right"><a href="/Capstone%E5%8F%8D%E6%B1%87%E7%BC%96%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8AAPI%E5%88%86%E6%9E%90%E5%8F%8A%E7%A4%BA%E4%BE%8B(%E4%BA%8C)/"><img class="next_cover lazyload" data-src="https://i.loli.net/2018/07/16/5b4c62f90e035.png" onerror="onerror=null;src='/img/404.png'"><div class="label">下一篇</div><div class="next_info"><span>Capstone反汇编引擎数据类型及API分析及示例(二)</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/Capstone反汇编引擎数据类型及API分析及示例(一)/" title="Capstone反汇编引擎数据类型及API分析及示例(一)"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2018/07/16/5b4c62738929d.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-07-26</div><div class="relatedPosts_title">Capstone反汇编引擎数据类型及API分析及示例(一)</div></div></a></div><div class="relatedPosts_item"><a href="/Capstone反汇编引擎数据类型及API分析及示例(二)/" title="Capstone反汇编引擎数据类型及API分析及示例(二)"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2018/07/16/5b4c62f90e035.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-07-27</div><div class="relatedPosts_title">Capstone反汇编引擎数据类型及API分析及示例(二)</div></div></a></div><div class="relatedPosts_item"><a href="/Capstone反汇编引擎数据类型及API分析及示例(四)/" title="Capstone反汇编引擎数据类型及API分析及示例(四)"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2018/07/16/5b4c6341c0e72.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-08-14</div><div class="relatedPosts_title">Capstone反汇编引擎数据类型及API分析及示例(四)</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = true == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'53gELcU5PPzXKUh1q21E5Nkh-gzGzoHsz',
  appKey:'pSNnuMbRDkWAE7j44yChrEce',
  placeholder:'请到 https://gitter.im/K-s-House/community 进行评论(╯‵□′)╯︵┻━┻',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(https://i.loli.net/2018/07/16/5b4c6341ac665.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2020 By kabeor</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>